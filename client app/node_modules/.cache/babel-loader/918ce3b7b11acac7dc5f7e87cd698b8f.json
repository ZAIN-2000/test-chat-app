{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\abria\\\\Desktop\\\\WSB\\\\test-chat-app\\\\client app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\abria\\\\Desktop\\\\WSB\\\\test-chat-app\\\\client app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:\\\\Users\\\\abria\\\\Desktop\\\\WSB\\\\test-chat-app\\\\client app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useRef,useState,useEffect}from\"react\";import axios from'axios';import{useHistory}from\"react-router-dom\";import{ChatEngine}from'react-chat-engine';import{useAuth}from\"../contexts/AuthContext\";import{auth}from\"../firebase\";export default function Chats(){var didMountRef=useRef(false);var _useState=useState(true),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useAuth=useAuth(),user=_useAuth.user;var history=useHistory();function handleLogout(){return _handleLogout.apply(this,arguments);}function _handleLogout(){_handleLogout=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return auth.signOut();case 2:history.push(\"/\");case 3:case\"end\":return _context.stop();}}},_callee);}));return _handleLogout.apply(this,arguments);}function getFile(_x){return _getFile.apply(this,arguments);}function _getFile(){_getFile=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(url){var response,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return fetch(url);case 2:response=_context2.sent;_context2.next=5;return response.blob();case 5:data=_context2.sent;return _context2.abrupt(\"return\",new File([data],\"test.jpg\",{type:'image/jpeg'}));case 7:case\"end\":return _context2.stop();}}},_callee2);}));return _getFile.apply(this,arguments);}useEffect(function(){if(!didMountRef.current){didMountRef.current=true;if(!user||user===null){history.push(\"/\");return;}// Get-or-Create should be in a Firebase Function\naxios.get('https://api.chatengine.io/users/me/',{headers:{\"project-id\":process.env.REACT_APP_CHAT_ENGINE_ID,\"user-name\":user.email,\"user-secret\":user.uid}}).then(function(){return setLoading(false);}).catch(function(e){var formdata=new FormData();formdata.append('email',user.email);formdata.append('username',user.email);formdata.append('secret',user.uid);getFile(user.photoURL).then(function(avatar){formdata.append('avatar',avatar,avatar.name);axios.post('https://api.chatengine.io/users/',formdata,{headers:{\"private-key\":process.env.REACT_APP_CHAT_ENGINE_KEY}}).then(function(){return setLoading(false);}).catch(function(e){return console.log('e',e.response);});});});// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n}},[user,history]);if(!user||loading)return/*#__PURE__*/React.createElement(\"div\",null);return/*#__PURE__*/React.createElement(\"div\",{className:\"chats-page\"},/*#__PURE__*/React.createElement(\"div\",{className:\"nav-bar\"},/*#__PURE__*/React.createElement(\"div\",{className:\"logo-tab\"},\"Unichat\"),/*#__PURE__*/React.createElement(\"div\",{onClick:handleLogout,className:\"logout-tab\"},\"Logout\")),/*#__PURE__*/React.createElement(ChatEngine,{height:\"calc(100vh - 66px)\",projectID:process.env.REACT_APP_CHAT_ENGINE_ID,userName:user.email,userSecret:user.uid}));}","map":{"version":3,"sources":["C:/Users/abria/Desktop/WSB/test-chat-app/client app/src/components/Chats.js"],"names":["React","useRef","useState","useEffect","axios","useHistory","ChatEngine","useAuth","auth","Chats","didMountRef","loading","setLoading","user","history","handleLogout","signOut","push","getFile","url","fetch","response","blob","data","File","type","current","get","headers","process","env","REACT_APP_CHAT_ENGINE_ID","email","uid","then","catch","e","formdata","FormData","append","photoURL","avatar","name","post","REACT_APP_CHAT_ENGINE_KEY","console","log"],"mappings":"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","sourcesContent":["import React, { useRef, useState, useEffect } from \"react\"\r\n\r\nimport axios from 'axios'\r\nimport { useHistory } from \"react-router-dom\"\r\nimport { ChatEngine } from 'react-chat-engine'\r\n\r\nimport { useAuth } from \"../contexts/AuthContext\"\r\n\r\nimport { auth } from \"../firebase\"\r\n\r\nexport default function Chats() {\r\n  const didMountRef = useRef(false)\r\n  const [ loading, setLoading ] = useState(true)\r\n  const { user } = useAuth()\r\n  const history = useHistory()\r\n\r\n  async function handleLogout() {\r\n    await auth.signOut()\r\n    history.push(\"/\")\r\n  }\r\n\r\n  async function getFile(url) {\r\n    let response = await fetch(url);\r\n    let data = await response.blob();\r\n    return new File([data], \"test.jpg\", { type: 'image/jpeg' });\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (!didMountRef.current) {\r\n      didMountRef.current = true\r\n\r\n      if (!user || user === null) {\r\n        history.push(\"/\")\r\n        return\r\n      }\r\n      \r\n      // Get-or-Create should be in a Firebase Function\r\n      axios.get(\r\n        'https://api.chatengine.io/users/me/',\r\n        { headers: { \r\n          \"project-id\": process.env.REACT_APP_CHAT_ENGINE_ID,\r\n          \"user-name\": user.email,\r\n          \"user-secret\": user.uid\r\n        }}\r\n      )\r\n\r\n      .then(() => setLoading(false))\r\n\r\n      .catch(e => {\r\n        let formdata = new FormData()\r\n        formdata.append('email', user.email)\r\n        formdata.append('username', user.email)\r\n        formdata.append('secret', user.uid)\r\n\r\n        getFile(user.photoURL)\r\n        .then(avatar => {\r\n          formdata.append('avatar', avatar, avatar.name)\r\n\r\n          axios.post(\r\n            'https://api.chatengine.io/users/',\r\n            formdata,\r\n            { headers: { \"private-key\": process.env.REACT_APP_CHAT_ENGINE_KEY }}\r\n          )\r\n          .then(() => setLoading(false))\r\n          .catch(e => console.log('e', e.response))\r\n        })\r\n      })\r\n      // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n\r\n    }\r\n  }, [user, history])\r\n  \r\n\r\n  if (!user || loading) return <div />\r\n\r\n  return (\r\n    <div className='chats-page'>\r\n      <div className='nav-bar'>\r\n        <div className='logo-tab'>\r\n          Unichat\r\n        </div>\r\n\r\n        <div onClick={handleLogout} className='logout-tab'>\r\n          Logout\r\n        </div>\r\n      </div>\r\n\r\n      <ChatEngine \r\n        height='calc(100vh - 66px)'\r\n        projectID= { process.env.REACT_APP_CHAT_ENGINE_ID}\r\n        userName={user.email}\r\n        userSecret={user.uid}\r\n      />\r\n    </div>\r\n  )\r\n}"]},"metadata":{},"sourceType":"module"}